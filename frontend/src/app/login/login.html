<div class="login-container">
  <div class="login-form">
    <!-- PestaÃ±as de navegaciÃ³n -->
    <div class="tabs-container">
      <button 
        [class.active]="currentTab === 'login'" 
        (click)="setTab('login')" 
        class="tab-btn login-tab">
        ğŸ” Login
      </button>
      <button 
        [class.active]="currentTab === 'signup'" 
        (click)="setTab('signup')" 
        class="tab-btn signup-tab">
        â• Signup
      </button>
      <button 
        [class.active]="currentTab === 'reset'" 
        (click)="setTab('reset')" 
        class="tab-btn reset-tab">
        ğŸ”‘ Recuperar
      </button>
    </div>

    <!-- Contenido de Login -->
    <div *ngIf="currentTab === 'login'" class="tab-content">
      <h2>ğŸ” Iniciar SesiÃ³n</h2>
      
      <div *ngIf="success" class="success">
        {{ success }}
      </div>
      <div *ngIf="error" class="error">
        {{ error }}
      </div>
      
      <form (ngSubmit)="onLogin()" #loginForm="ngForm">
        <div class="form-group">
          <label for="email">ğŸ“§ Email:</label>
          <input 
            type="email" 
            id="email" 
            name="email"
            [(ngModel)]="email" 
            required 
            class="form-input"
            placeholder="tu@email.com">
        </div>
        
        <div class="form-group">
          <label for="password">ğŸ”’ ContraseÃ±a:</label>
          <input 
            type="password" 
            id="password" 
            name="password"
            [(ngModel)]="password" 
            required 
            class="form-input"
            placeholder="Tu contraseÃ±a">
        </div>
        
        <button type="submit" [disabled]="isLoading" class="submit-btn">
          <span *ngIf="!isLoading">ğŸš€ Iniciar SesiÃ³n</span>
          <span *ngIf="isLoading">â³ Iniciando...</span>
        </button>
      </form>
    </div>

    <!-- Contenido de Signup -->
    <div *ngIf="currentTab === 'signup'" class="tab-content">
      <h2>â• Crear Cuenta</h2>
      
      <div *ngIf="signupSuccess" class="success">
        {{ signupSuccess }}
      </div>
      <div *ngIf="signupError" class="error">
        {{ signupError }}
      </div>
      
      <form (ngSubmit)="onSignup()" #signupForm="ngForm">
        <div class="form-group">
          <label for="signup-name">ğŸ‘¤ Nombre:</label>
          <input 
            type="text" 
            id="signup-name" 
            name="name"
            [(ngModel)]="signupData.name" 
            required 
            class="form-input"
            placeholder="Tu nombre completo">
        </div>
        
        <div class="form-group">
          <label for="signup-email">ğŸ“§ Email:</label>
          <input 
            type="email" 
            id="signup-email" 
            name="signupEmail"
            [(ngModel)]="signupData.email" 
            required 
            class="form-input"
            placeholder="tu@email.com">
        </div>
        
        <div class="form-group">
          <label for="signup-password">ğŸ”’ ContraseÃ±a:</label>
          <input 
            type="password" 
            id="signup-password" 
            name="signupPassword"
            [(ngModel)]="signupData.password" 
            required 
            class="form-input"
            placeholder="Ej: Admin123!"
            minlength="6">
          <small class="password-requirements">
            ğŸ“‹ Requisitos: MÃ­nimo 6 caracteres, mayÃºscula inicial, nÃºmero y carÃ¡cter especial
          </small>
        </div>
        
        <div class="form-group">
          <label for="signup-confirm">ğŸ” Confirmar ContraseÃ±a:</label>
          <input 
            type="password" 
            id="signup-confirm" 
            name="signupConfirm"
            [(ngModel)]="signupData.confirmPassword" 
            required 
            class="form-input"
            placeholder="Repite tu contraseÃ±a">
        </div>
        
        <button type="submit" [disabled]="isSignupLoading" class="submit-btn signup-btn">
          <span *ngIf="!isSignupLoading">âœ… Crear Cuenta</span>
          <span *ngIf="isSignupLoading">â³ Creando...</span>
        </button>
      </form>
    </div>

    <!-- PestaÃ±a de Recuperar ContraseÃ±a -->
    <div *ngIf="currentTab === 'reset'" class="tab-content reset-tab-content">
      <h2>ğŸ”‘ Recuperar ContraseÃ±a</h2>
      
      <div class="reset-form">
        <p class="instruction-text">
          ğŸ“§ Ingresa tu email para recibir instrucciones de recuperaciÃ³n de contraseÃ±a.
        </p>
        
        <form (ngSubmit)="onResetPassword()" #resetForm="ngForm">
          <div class="form-group">
            <label for="reset-email">ğŸ“§ Email:</label>
            <input 
              type="email" 
              id="reset-email" 
              name="resetEmail"
              [(ngModel)]="resetData.email" 
              required 
              class="form-input"
              placeholder="ejemplo@correo.com"
              [disabled]="isResetLoading">
          </div>
          
          <button type="submit" [disabled]="isResetLoading" class="submit-btn reset-btn">
            <span *ngIf="!isResetLoading">ğŸ“§ Enviar Instrucciones</span>
            <span *ngIf="isResetLoading">â³ Enviando...</span>
          </button>
          
          <!-- BotÃ³n de prueba para abrir modal -->
          <button type="button" (click)="testOpenModal()" class="test-modal-btn">
            ğŸ”‘ Cambiar ContraseÃ±a
          </button>
        </form>
        
        <!-- Mensajes de estado -->
        <div *ngIf="resetSuccess" class="reset-success">
          {{ resetSuccess }}
        </div>
        
        <div *ngIf="resetError" class="reset-error">
          {{ resetError }}
        </div>
      </div>
    </div>

    <!-- InformaciÃ³n de la API -->
    <div class="api-info">
      <h3>ğŸ”— InformaciÃ³n de la API</h3>
      <p><strong>ğŸ” Login:</strong> POST http://localhost:3000/api/users/login</p>
      <p><strong>â• Signup:</strong> POST http://localhost:3000/api/users</p>
      <p><strong>ğŸ”‘ Reset Password:</strong> POST http://localhost:3000/api/tokens/reset-password</p>
      <p><strong>ğŸ” AutenticaciÃ³n:</strong> Bearer Token requerido para libros</p>
    </div>
    
    <div class="test-users">
      <h4>ğŸ§ª Usuarios de Prueba</h4>
      <ul>
        <li><strong>Email:</strong> admin@test.com | <strong>Password:</strong> Admin123!</li>
        <li><strong>Email:</strong> user@test.com | <strong>Password:</strong> User123!</li>
        <li><strong>Email:</strong> test@test.com | <strong>Password:</strong> Test123!</li>
      </ul>
    </div>
    
    <div class="token-actions">
      <h4>ğŸ”‘ GestiÃ³n de Token</h4>
      <button (click)="clearToken()" class="clear-token-btn">
        ğŸ§¹ Limpiar Token
      </button>
      <button *ngIf="hasValidToken()" (click)="goToBooks()" class="go-books-btn">
        ğŸ“š Ir a Libros
      </button>
      <p class="token-info">Ãštil para testing y logout manual</p>
    </div>
  </div>
  
  <!-- Modal para mostrar datos de reset password -->
  <div *ngIf="showResetModal" class="modal-overlay" (click)="closeResetModal()">
    <div class="modal-content reset-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>ğŸ”‘ Cambiar ContraseÃ±a</h2>
        <button class="close-btn" (click)="closeResetModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="reset-token-info">
          <div class="info-section">
            <h3>ğŸ“§ Email: {{ resetData.email }}</h3>
            <div class="token-display" *ngIf="resetTokenData.token">
              <h4>ğŸ”‘ Reset Token:</h4>
              <div class="token-input-group">
                <input 
                  type="text" 
                  class="token-input" 
                  [value]="resetTokenData.token" 
                  readonly>
                <button 
                  type="button" 
                  class="copy-btn" 
                  (click)="copyResetToken()"
                  [class.copied]="tokenCopied">
                  <span *ngIf="!tokenCopied">ğŸ“‹ Copiar</span>
                  <span *ngIf="tokenCopied">âœ… Copiado</span>
                </button>
              </div>
              <p class="token-info">
                <strong>â° Creado:</strong> {{ resetTokenData.createdAt ? (resetTokenData.createdAt | date:'medium') : 'No especificado' }}
              </p>
            </div>
            <p class="instruction">Ingresa el resetToken y tu nueva contraseÃ±a:</p>
          </div>
          
          <form (ngSubmit)="confirmResetPassword()" #resetPasswordForm="ngForm">
            <div class="form-group">
              <label for="reset-token-input">ğŸ”‘ Reset Token:</label>
              <input 
                type="text" 
                id="reset-token-input" 
                name="resetToken"
                [(ngModel)]="resetPasswordData.token" 
                required 
                class="form-input"
                placeholder="Pega aquÃ­ el resetToken de recuperaciÃ³n">
            </div>
            
            <div class="form-group">
              <label for="new-password">ğŸ”’ Nueva ContraseÃ±a:</label>
              <input 
                type="password" 
                id="new-password" 
                name="newPassword"
                [(ngModel)]="resetPasswordData.newPassword" 
                required 
                class="form-input"
                placeholder="Ej: NuevaPass123!"
                minlength="6">
              <small class="password-requirements">
                ğŸ“‹ Requisitos: MÃ­nimo 6 caracteres, mayÃºscula inicial, nÃºmero y carÃ¡cter especial
              </small>
            </div>
            
            <div class="form-group">
              <label for="confirm-new-password">ğŸ” Confirmar Nueva ContraseÃ±a:</label>
              <input 
                type="password" 
                id="confirm-new-password" 
                name="confirmNewPassword"
                [(ngModel)]="resetPasswordData.confirmPassword" 
                required 
                class="form-input"
                placeholder="Repite tu nueva contraseÃ±a">
            </div>
            
            <div class="form-actions">
              <button type="submit" [disabled]="isConfirmingReset" class="submit-btn reset-confirm-btn">
                <span *ngIf="!isConfirmingReset">ğŸ’¾ Cambiar ContraseÃ±a</span>
                <span *ngIf="isConfirmingReset">â³ Cambiando...</span>
              </button>
            </div>
          </form>
          
          <div class="token-help">
            <h4>â“ Â¿No tienes el token?</h4>
            <p>Si no tienes el token de recuperaciÃ³n, solicita uno nuevo en la pestaÃ±a "Recuperar".</p>
            <button (click)="requestNewToken()" class="request-token-btn">
              ğŸ”‘ Solicitar Nuevo Token
            </button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="close-modal-btn" (click)="closeResetModal()">
          Cerrar
        </button>
      </div>
    </div>
  </div>
</div>
