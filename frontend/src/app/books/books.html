<div class="books-container">
  <div class="books-header">
    <h1>ğŸ“š Biblioteca de Libros</h1>
    <div class="user-info">
      <span>ğŸ‘¤ Usuario: {{ getUserEmail() }} ({{ getUserRole() }})</span>
      <button (click)="logout()" class="logout-btn">ğŸšª Cerrar SesiÃ³n</button>
    </div>
  </div>
  
  <div class="books-section">
    <h2>ğŸ“– Lista de Libros ({{ totalCount }})</h2>
    
    <!-- Indicador de carga automÃ¡tica -->
    <div *ngIf="isLoading" class="auto-loading">
      <p>ğŸ”— Probando API automÃ¡ticamente...</p>
      <div class="loading-spinner"></div>
    </div>
    
    <!-- BotÃ³n de debug para verificar estado -->
    <div class="debug-buttons">
      <button (click)="viewBooks()" class="debug-btn">
        ğŸ“š Ver Libros
      </button>
      <button (click)="showCreateBookModal()" class="create-book-btn">
        â• Crear Libro
      </button>
    </div>
    
    <!-- Botones de filtro -->
    <div class="filter-buttons">
      <h4>ğŸ” Filtros de Libros</h4>
      <div class="filter-container">
        <button 
          *ngFor="let filter of filterButtons" 
          (click)="applyFilter(filter.key)"
          [class.active]="currentFilter === filter.key"
          class="filter-btn"
          [class.filter-all]="filter.key === 'all'"
          [class.filter-available]="filter.key === 'available'"
          [class.filter-reserved]="filter.key === 'reserved'"
        >
          <span class="filter-icon">{{ filter.icon }}</span>
          <span class="filter-label">{{ filter.label }}</span>
          <span class="filter-count">({{ getFilterCount(filter.key) }})</span>
        </button>
      </div>
      <p class="filter-info">
        Filtro actual: <strong>{{ getFilterLabel(currentFilter) }}</strong>
      </p>
    </div>

    <!-- BÃºsqueda por tÃ­tulo -->
    <div class="search-section">
      <h4>ğŸ” BÃºsqueda por TÃ­tulo</h4>
      <div class="search-container">
        <input 
          type="text" 
          [(ngModel)]="searchTitle" 
          placeholder="Ingresa el tÃ­tulo del libro..."
          class="search-input"
          (input)="onSearchInputChange()"
          (keyup.enter)="onSearchKeyPress($event)"
        >
        <button (click)="clearSearch()" class="clear-search-btn" [disabled]="!searchTitle.trim()">
          ğŸ—‘ï¸ Limpiar
        </button>
      </div>
      
      <!-- InformaciÃ³n de bÃºsqueda -->
      <div *ngIf="searchTitle.trim()" class="search-info">
        <p *ngIf="isSearching" class="search-status">
          ğŸ” Buscando libros con tÃ­tulo: <strong>"{{ searchTitle }}"</strong>
        </p>
        <p *ngIf="!isSearching && searchResults.length > 0" class="search-results">
          âœ… Encontrados <strong>{{ searchResults.length }}</strong> libros con tÃ­tulo: <strong>"{{ searchTitle }}"</strong>
        </p>
        <p *ngIf="!isSearching && searchResults.length === 0 && searchTitle.trim()" class="no-search-results">
          ğŸ“­ No se encontraron libros con tÃ­tulo: <strong>"{{ searchTitle }}"</strong>
        </p>
      </div>
    </div>
    
    <!-- Mensaje de error -->
    <div *ngIf="!isLoading && error" class="error">
      âŒ {{ error }}
    </div>
    
    <!-- Lista de libros -->
    <div *ngIf="!isLoading && !error && getBooksToShow().length > 0" class="books-list">
      <!-- Indicador de tipo de resultados -->
      <div *ngIf="isShowingSearchResults()" class="search-results-header">
        <h3>ğŸ” Resultados de BÃºsqueda para "{{ searchTitle }}"</h3>
        <p>Mostrando {{ searchResults.length }} libro(s) encontrado(s)</p>
      </div>
      
      <div *ngFor="let book of getBooksToShow()" class="book-card" (click)="showBookModal(book)">
        <h3>{{ book.title }}</h3>
        <p><strong>Autor:</strong> {{ book.author }}</p>
        <p><strong>AÃ±o:</strong> {{ book.publicationYear }}</p>
        <span class="status-badge" [ngClass]="getStatusClass(book.status)">
          {{ getStatusText(book.status) }}
        </span>
      </div>
    </div>
    <div *ngIf="!isLoading && !error && getBooksToShow().length === 0" class="no-books">
      <p *ngIf="isShowingSearchResults()">ğŸ“­ No se encontraron libros con tÃ­tulo "{{ searchTitle }}"</p>
      <p *ngIf="!isShowingSearchResults() && books.length > 0">ğŸ“­ No hay libros que coincidan con el filtro "{{ getFilterLabel(currentFilter) }}"</p>
      <p *ngIf="!isShowingSearchResults() && books.length === 0">ğŸ“­ No se encontraron libros</p>
    </div>
    
    <!-- InformaciÃ³n de la API -->
    <div class="api-info">
      <h3>ğŸ”— InformaciÃ³n de la API</h3>
      <p><strong>Endpoint:</strong> GET http://localhost:3000/api/books</p>
      <p><strong>MÃ©todo:</strong> GET</p>
      <p><strong>Estado:</strong> 
        <span *ngIf="isLoading" class="status-loading">â³ Probando automÃ¡ticamente...</span>
        <span *ngIf="!isLoading && !error" class="status-success">âœ… Cargado automÃ¡ticamente</span>
        <span *ngIf="!isLoading && error" class="status-error">âŒ Error en carga automÃ¡tica</span>
      </p>
    </div>
  </div>
  
  <!-- Modal del libro -->
  <div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>ğŸ“š {{ selectedBook?.title }}</h2>
        <button class="close-btn" (click)="closeModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="book-details">
          <!-- Modo de visualizaciÃ³n -->
          <div *ngIf="!isEditing">
            <p><strong>ğŸ“ TÃ­tulo:</strong> {{ selectedBook?.title }}</p>
            <p><strong>âœï¸ Autor:</strong> {{ selectedBook?.author }}</p>
            <p><strong>ğŸ“… AÃ±o de publicaciÃ³n:</strong> {{ selectedBook?.publicationYear }}</p>
            <p><strong>ğŸ·ï¸ Estado:</strong> 
              <span class="status-badge" [ngClass]="getStatusClass(selectedBook?.status || '')">
                {{ getStatusText(selectedBook?.status || '') }}
              </span>
            </p>
            <p *ngIf="selectedBook?.createdAt"><strong>ğŸ“… Creado:</strong> {{ selectedBook?.createdAt | date:'medium' }}</p>
            <p *ngIf="selectedBook?.updatedAt"><strong>ğŸ”„ Actualizado:</strong> {{ selectedBook?.updatedAt | date:'medium' }}</p>
            <p><strong>ğŸ†” ID:</strong> {{ selectedBook?.bookId }}</p>
          </div>
          
          <!-- Modo de ediciÃ³n -->
          <div *ngIf="isEditing" class="edit-form">
            <h3>âœï¸ Editando: {{ editingBook?.title }}</h3>
            
            <div class="form-group">
              <label for="edit-title">ğŸ“ TÃ­tulo:</label>
              <input 
                type="text" 
                id="edit-title" 
                [(ngModel)]="editingBook!.title" 
                class="form-input"
                placeholder="Ingresa el tÃ­tulo del libro">
            </div>
            
            <div class="form-group">
              <label for="edit-author">âœï¸ Autor:</label>
              <input 
                type="text" 
                id="edit-author" 
                [(ngModel)]="editingBook!.author" 
                class="form-input"
                placeholder="Ingresa el nombre del autor">
            </div>
            
            <div class="form-group">
              <label for="edit-year">ğŸ“… AÃ±o de publicaciÃ³n:</label>
              <input 
                type="number" 
                id="edit-year" 
                [(ngModel)]="editingBook!.publicationYear" 
                class="form-input"
                placeholder="Ej: 1954"
                min="1000" 
                max="2025">
            </div>
            
            <div class="form-group">
              <label for="edit-status">ğŸ·ï¸ Estado:</label>
              <select 
                id="edit-status" 
                [(ngModel)]="editingBook!.status" 
                class="form-select">
                <option value="available">Disponible</option>
                <option value="reserved">Reservado</option>
              </select>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <!-- Botones en modo de visualizaciÃ³n -->
        <div *ngIf="!isEditing">
          <button class="edit-book-btn" (click)="editBook()">
            âœï¸ Editar Libro
          </button>
          <button class="delete-book-btn" (click)="deleteBook()">
            ğŸ—‘ï¸ Borrar Libro
          </button>
          <button class="close-modal-btn" (click)="closeModal()">
            Cerrar
          </button>
        </div>
        
        <!-- Botones en modo de ediciÃ³n -->
        <div *ngIf="isEditing">
          <button class="save-book-btn" (click)="saveBookChanges()">
            ğŸ’¾ Guardar Cambios
          </button>
          <button class="cancel-edit-btn" (click)="cancelEdit()">
            âŒ Cancelar
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal para crear libro -->
  <div *ngIf="showCreateModal" class="modal-overlay" (click)="closeCreateModal()">
    <div class="modal-content create-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>â• Crear Nuevo Libro</h2>
        <button class="close-btn" (click)="closeCreateModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="create-form">
          <div class="form-group">
            <label for="create-title">ğŸ“ TÃ­tulo:</label>
            <input 
              type="text" 
              id="create-title" 
              [(ngModel)]="newBook.title" 
              class="form-input"
              placeholder="Ingresa el tÃ­tulo del libro"
              required>
          </div>
          
          <div class="form-group">
            <label for="create-author">âœï¸ Autor:</label>
            <input 
              type="text" 
              id="create-author" 
              [(ngModel)]="newBook.author" 
              class="form-input"
              placeholder="Ingresa el nombre del autor"
              required>
          </div>
          
          <div class="form-group">
            <label for="create-year">ğŸ“… AÃ±o de publicaciÃ³n:</label>
            <input 
              type="number" 
              id="create-year" 
              [(ngModel)]="newBook.publicationYear" 
              class="form-input"
              placeholder="Ej: 1954"
              min="1000" 
              max="2025"
              required>
          </div>
          
          <div class="form-group">
            <label for="create-status">ğŸ·ï¸ Estado:</label>
            <select 
              id="create-status" 
              [(ngModel)]="newBook.status" 
              class="form-select"
              required>
              <option value="available">Disponible</option>
              <option value="reserved">Reservado</option>
            </select>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="save-book-btn" (click)="createBook()">
          ğŸ’¾ Crear Libro
        </button>
        <button class="cancel-edit-btn" (click)="closeCreateModal()">
          âŒ Cancelar
        </button>
      </div>
    </div>
  </div>
</div>
